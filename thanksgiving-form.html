<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thanksgiving Family Application - Moms On a Mission</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        .form-container {
            max-width: 700px;
            margin: 2rem auto;
            padding: 2rem;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #3b3a30;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #b2c2bf;
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #3b3a30;
        }

        .submit-btn {
            width: 100%;
            padding: 1rem;
            background-color: #b2c2bf;
            color: #3b3a30;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .submit-btn:hover:not(:disabled) {
            background-color: #c0ded9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .submit-btn:disabled {
            background-color: #d0d0d0;
            cursor: not-allowed;
        }

        .message {
            padding: 1rem;
            border-radius: 5px;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="nav-container">
                <div class="logo">
                    <img src="images/moms logo1.jpg" alt="Moms On a Mission Logo" class="logo-img">
                    <div class="logo-text">
                        <h1>Moms On a Mission</h1>
                        <p class="tagline">Serving Our Community with Love</p>
                    </div>
                </div>
                <ul class="nav-menu">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="missions.html">Missions</a></li>
                    <li><a href="holiday-help.html" class="active">Holiday Help</a></li>
                    <li><a href="donate.html" class="donate-btn">Donate</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <main>
        <section class="hero">
            <div class="hero-content">
                <h2>Thanksgiving Family Application</h2>
                <p>Apply for assistance with your Thanksgiving celebration. We're here to help!</p>
            </div>
        </section>

        <section style="padding: 2rem;">
            <div class="form-container">
                <div id="statusMessage"></div>
                
                <form id="thanksgivingForm">
                    <div class="form-group">
                        <label for="familyName">Family Name *</label>
                        <input type="text" id="familyName" name="familyName" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="numberOfAdults">Number of Adults *</label>
                            <input type="number" id="numberOfAdults" name="numberOfAdults" min="0" required>
                        </div>

                        <div class="form-group">
                            <label for="numberOfChildren">Number of Children *</label>
                            <input type="number" id="numberOfChildren" name="numberOfChildren" min="0" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="streetAddress">Street Address *</label>
                        <input type="text" id="streetAddress" name="streetAddress" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="city">City *</label>
                            <input type="text" id="city" name="city" required>
                        </div>

                        <div class="form-group">
                            <label for="zipCode">Zip Code *</label>
                            <input type="text" id="zipCode" name="zipCode" pattern="[0-9]{5}" title="Please enter a 5-digit zip code" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="phoneNumber">Phone Number *</label>
                        <input type="tel" id="phoneNumber" name="phoneNumber" required>
                    </div>

                    <div class="form-group">
                        <label for="emailAddress">Email Address *</label>
                        <input type="email" id="emailAddress" name="emailAddress" required>
                    </div>

                    <button type="submit" class="submit-btn" id="submitBtn">
                        Submit Application
                    </button>
                </form>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div style="margin-bottom: 1rem;">
                    <p style="margin: 0;"><strong>Moms On a Mission</strong></p>
                    <p style="margin: 0.25rem 0;">440 McBride Ave, Dupo, IL 62239</p>
                    <p style="margin: 0.25rem 0;">EIN: 36-4837678</p>
                </div>
                <div class="footer-social">
                    <a href="https://www.facebook.com/groups/343793369162470" target="_blank" class="social-link">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                        </svg>
                        Facebook
                    </a>
                </div>
                <p>&copy; 2025 Moms On a Mission. All rights reserved. | 501(c)(3) Non-Profit Public Charity</p>
            </div>
        </div>
    </footer>

    <script>
        // Supabase credentials
        const SUPABASE_URL = 'https://fyxsebearstooizcolnw.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ5eHNlYmVhcnN0b29pemNvbG53Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA2MjgzOTAsImV4cCI6MjA3NjIwNDM5MH0.alg1RGNyDpT8thI-yH_RvgneSKS9ZDk3zirlkf-uhBk';

        // Initialize Supabase client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        const form = document.getElementById('thanksgivingForm');
        const submitBtn = document.getElementById('submitBtn');
        const statusMessage = document.getElementById('statusMessage');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';
            statusMessage.innerHTML = '';

            try {
                // Check current submission count
                const { count, error: countError } = await supabase
                    .from('family_submissions')
                    .select('*', { count: 'exact', head: true });

                if (countError) {
                    throw new Error('Failed to check submission limit');
                }

                // Check if limit reached (500 submissions)
                if (count !== null && count >= 500) {
                    statusMessage.innerHTML = '<div class="message error">We have reached our maximum number of submissions. Thank you for your interest!</div>';
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Submit Application';
                    return;
                }

                // Get form data
                const formData = new FormData(form);
                const data = {
                    family_name: formData.get('familyName'),
                    number_of_adults: parseInt(formData.get('numberOfAdults')),
                    number_of_children: parseInt(formData.get('numberOfChildren')),
                    street_address: formData.get('streetAddress'),
                    city: formData.get('city'),
                    zip_code: formData.get('zipCode'),
                    phone_number: formData.get('phoneNumber'),
                    email_address: formData.get('emailAddress')
                };

                // Submit to Supabase
                const { error } = await supabase
                    .from('family_submissions')
                    .insert([data]);

                if (error) {
                    throw error;
                }

                // Success!
                statusMessage.innerHTML = '<div class="message success">Application submitted successfully! Thank you for applying. We will contact you soon.</div>';
                form.reset();
                
                // Scroll to message
                statusMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

            } catch (error) {
                console.error('Error:', error);
                statusMessage.innerHTML = '<div class="message error">An error occurred while submitting your application. Please try again.</div>';
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Application';
            }
        });
    </script>
</body>
</html>
